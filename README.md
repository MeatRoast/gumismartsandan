# ISE통합플랫폼 SQL 수정
## 통합안전지수
1. 간결화 및 그룹화:

초기 코드에서는 각 요소(유해물질, 자연재해, 화재발생, 범죄사고)에 대한 계산이 개별적으로 작성되어 있었지만, 최적화된 코드에서는 최근과 이전 데이터를 그룹화하여 전체 집계를 한 번에 수행하도록 하였습니다.
이를 통해 코드가 단순해지고, 중복된 코드를 줄였습니다.

2. NULL 및 음수 값 처리 방식 개선:

초기 코드에서는 IFNULL을 사용해 NULL 값을 1로 대체했으나, 이는 안전지수에 불필요한 기본 점수를 부여할 수 있었습니다.
최적화된 코드에서는 COALESCE와 GREATEST를 함께 사용하여, NULL을 0으로 대체하고 음수는 0으로 제한하여 계산의 정확성을 높였습니다.

3. 안전한 비율 계산:

초기 코드에서는 나눗셈 계산 중 b.유해물질, b.자연재해 등이 0일 경우 오류 가능성이 있었고, 이를 IFNULL로 처리하여 비율이 왜곡될 수 있었습니다.
최적화된 코드에서는 NULLIF를 사용해 0으로 나누는 오류를 방지하고, 보다 안전하게 비율을 계산하도록 했습니다.

4. 최종 통합안전지수 계산 구조:

초기 코드에서는 **(유해물질 + 자연재해 + 화재발생 + 범죄사고) * 100** 형태였지만, 최적화된 코드에서는 **100 - (유해물질 + 자연재해 + 화재발생 + 범죄사고)**로 계산 구조를 변경하여 위협 요소가 증가할수록 점수가 낮아지는 방식으로 조정했습니다.


## 통합안전지수 건수
1.날짜 조건 수정
- **b 서브쿼리**에서 **from_unixtime(occurTime/1000)**에 중첩된 **date_add**가 잘못되어, **DATE_ADD(NOW(), INTERVAL -14 DAY)와 DATE_ADD(NOW(), INTERVAL -7 DAY)** 조건을 사용하여 기간을 명확하게 변경했습니다

2. 조건 정리:
- **from_unixtime(occurTime/1000)** 조건에서 잘못된 중첩 부분을 제거하고, 단순히 각 서브쿼리의 기간을 비교하는 조건으로 변경했습니다.
